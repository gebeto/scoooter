<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>Scoooters</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
	<style type="text/css">
		body {
			padding: 0;
			margin: 0;
		}
		html, body, #map {
			height: 100%;
			width: 100vw;
		}
		ul {
			padding: 0;
			list-style: none;
		}
	</style>
</head>
<body>
	<div id="map"></div>
	<script>
		function fetchScooters() {
			return fetch("/scooters.json").then(res => res.json());
		}

		const mymap = L.map('map').setView([49.8360948918759, 24.025636129081246], 12);

		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 18,
			minZoom: 12,
			id: 'mapbox/streets-v11',
			tileSize: 512,
			zoomOffset: -1,
		}).addTo(mymap);

		// const marker = L.marker([49.8360948918759, 24.025636129081246]).addTo(mymap);
		// marker.bindPopup("<b>Kiwi</b><br><ul><li>I am a popup.</li><li>I am a popup.</li></ul>").openPopup();

		// const polygon = L.polygon([
		// 	[51.509, -0.08],
		// 	[51.503, -0.06],
		// 	[51.51, -0.047]
		// ]).addTo(mymap);

		var kiwiMarker = L.icon({
			iconUrl: 'marker-kiwi.svg',
			iconSize: [34, 34],
			iconAnchor: [17, 0],
			popupAnchor: [0, 0],
			// shadowUrl: 'my-icon-shadow.png',
			// shadowSize: [68, 95],
			// shadowAnchor: [22, 94]
		});

		var ewingsMarker = L.icon({
			iconUrl: 'marker-ewings.svg',
			iconSize: [34, 34],
			iconAnchor: [17, 0],
			popupAnchor: [0, 0],
			// shadowUrl: 'my-icon-shadow.png',
			// shadowSize: [68, 95],
			// shadowAnchor: [22, 94]
		});

		const markersByType = {
			kiwi: kiwiMarker,
			ewings: ewingsMarker,
		}

		fetchScooters().then(scooters => {
			scooters.map(scooter => {
				const marker = L.marker([scooter.location.lat, scooter.location.lon])
					.setIcon(markersByType[scooter.type])
					.addTo(mymap);
				marker.bindPopup(`
					<b>Type: ${scooter.type}</b>
					<br>
					<ul>
						<li>Name: ${scooter.title}</li>
						<li>Battery: ${scooter.battery}</li>
					</ul>
				`);
				marker.on('click', () => {
					// alert(JSON.stringify(scooter));
					console.log(scooter);
				});
			})
		})
	</script>
</body>
</html>